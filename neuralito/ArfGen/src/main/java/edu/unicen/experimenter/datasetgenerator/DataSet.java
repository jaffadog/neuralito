package edu.unicen.experimenter.datasetgenerator;

import java.io.Serializable;
import java.util.Arrays;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;
import java.util.List;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

import org.hibernate.annotations.CollectionOfElements;

import edu.unicen.experimenter.datasetgenerator.generators.GenerationStrategy;

/**
 * A dataset.
 * 
 * @author esteban
 * 
 */
@Entity
public class DataSet {

	/**
	 * Entity autogenerated id.
	 */
	@Id
	@GeneratedValue(strategy = GenerationType.AUTO)
	private Integer id;
	/**
	 * The date this dataset was created
	 */
	private Date creationDate;
	@Column(length = 5000)
	private GenerationStrategy generationStrategy;
	// Serialized

	private HashMap<String, Serializable> strategyOptions;

	private int numberOfInstances;

	public int getNumberOfInstances() {
		return numberOfInstances;
	}

	private String dataSetGroup = "NoName";

	@Column(length = 5000)
	private String[] attributes;

	private String classAttribute;

	private String beach;

	public String getBeach() {
		return beach;
	}

	public HashMap<String, Serializable> getStrategyOptions() {
		return strategyOptions;
	}

	private String dataSetName;
	@Column(length = 1000)
	private String dataSetDescription;

	@CollectionOfElements(fetch = FetchType.LAZY)
	private List<DataSetInstance> instances;
	private String generationStrategyName;
	@Column(length = 1000)
	private String attributes_String;
	private String strategyOptionString;
	private String[] years;

	public DataSet() {
		// default empty constructor ORM purpose.
	}

	/**
	 * @return
	 */
	public int getId() {
		return id;
	}

	public DataSet(final String name, final String description,
			final List instances, final String[] attributes,
			final String classAttribute,
			final GenerationStrategy generationStrategy) {
		dataSetName = name;
		this.instances = instances;
		this.attributes = attributes;
		this.classAttribute = classAttribute;
		dataSetDescription = description;
		this.generationStrategy = generationStrategy;
		generationStrategyName = generationStrategy.getName();
		beach = generationStrategy.getBeach();
		creationDate = new Date();
		attributes_String = Arrays.toString(attributes);
		numberOfInstances = instances.size();
		strategyOptionString = generationStrategy.getStrategyOptions()
				.toString();

	}

	public Collection<DataSetInstance> getInstances() {
		return instances;
	}

	public String getName() {
		return dataSetName;
	}

	public String getDescription() {
		// TODO Auto-generated method stub
		return dataSetDescription;
	}

	public String[] getAttributes() {
		return attributes;
	}

	public void setAttributes(final String[] attributes) {
		this.attributes = attributes;
	}

	public String getClassAttribute() {
		return classAttribute;
	}

	public int getClassAttributeIndex() {
		for (int i = 0; i < attributes.length; i++)
			if (attributes[i] == classAttribute)
				return i;
		return -1;
	}

	public void setClassAttribute(final String classAttribute) {
		this.classAttribute = classAttribute;
	}

	public GenerationStrategy getGenerationStrategy() {
		return generationStrategy;
	}

	// /**
	// * @param creationDate
	// * @param generationStrategy
	// * @param strategyOptions
	// * @param numberOfInstances
	// * @param attributes
	// * @param classAttribute
	// * @param beach
	// * @param data
	// * @throws Exception
	// */
	// public DataSet(final DataSetGenerationStrategy generationStrategy,
	// final HashMap<String, Serializable> strategyOptions,
	// final int numberOfInstances, final String[] attributes,
	// final String classAttribute, final String beach,
	// final List<ArfData> data) throws Exception {
	// super();
	// belongsToAttributes(attributes, classAttribute);
	// Validate.notNull(strategyOptions);
	// Validate.notNull(generationStrategy);
	// Validate.notNull(attributes);
	// Validate.notEmpty(classAttribute);
	// Validate.notEmpty(beach);
	// Validate.notNull(data);
	//
	// creationDate = new Date();
	// this.generationStrategy = generationStrategy;
	// generationStrategyName = generationStrategy.getName();
	// this.strategyOptions = strategyOptions;
	// this.numberOfInstances = numberOfInstances;
	// this.attributes = attributes;
	// attributes_String = Arrays.toString(attributes);
	//
	// this.classAttribute = classAttribute;
	//
	// this.beach = beach;
	// this.data = data;
	// }

	/**
	 * @param attributes
	 * @param classAttribute
	 * @throws Exception
	 */
	private void belongsToAttributes(final String[] attributes,
			final String classAttribute) throws Exception {
		for (int i = 0; i < attributes.length; i++) {
			if (attributes[i].equals(classAttribute))
				return;
		}
		throw new Exception(
				"Class attribute does not appear in the attribute list");

	}

	/**
	 * @return the attributes_String
	 */
	public String getAttributes_String() {
		return attributes_String;
	}

	/**
	 * @return the strategyOptionString
	 */
	public String getStrategyOptionString() {
		return strategyOptionString;
	}

	/**
	 * @return the dataSetGroup
	 */
	public String getDataSetGroup() {
		return dataSetGroup;
	}

	/**
	 * @param dataSetGroup
	 *            the dataSetGroup to set
	 */
	public void setDataSetGroup(final String dataSetGroup) {
		this.dataSetGroup = dataSetGroup;
	}

	/**
	 * @param years
	 */
	public void setYears(final String[] years) {
		this.years = years;

	}

	/**
	 * @return the years
	 */
	public String[] getYears() {
		return years;
	}

}
