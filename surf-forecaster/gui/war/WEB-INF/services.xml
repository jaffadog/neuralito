<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

	<import resource="dao.xml" />
	<bean id="userService"
		class="edu.unicen.surfforecaster.server.services.UserServiceImplementation">
		<property name="userDAO" ref="userDAO"></property>
	</bean>
	<bean id="spotService"
		class="edu.unicen.surfforecaster.server.services.SpotServiceImplementation">
		<property name="userDAO" ref="userDAO"></property>
		<property name="spotDAO" ref="spotDAO"></property>
	</bean>
	<bean id="forecastService"
		class="edu.unicen.surfforecaster.server.services.ForecastServiceImplementation">
		<property name="forecastDAO" ref="forecastDAO"></property>
		<property name="spotDAO" ref="spotDAO"></property>
		<property name="observationsSetDAO" ref="visualObservationsSetDAO"></property>
		<property name="models">
			<map>
				<entry key="GlobalModel" value-ref="waveWatchDaoTarget" />
			</map>
		</property>
	</bean>
	<!--
		QUARTZ SCHEDULER CONFIGURATION
	-->
	<!--
	-->
	<!--
		AUTOMATIC DOWNLOAD OF NOAA FORECASTS
	-->

	<!--    THE JOB -->
	<bean name="downloadNOAAForecastsJob" class="org.springframework.scheduling.quartz.JobDetailBean">
		<property name="jobClass"
			value="edu.unicen.surfforecaster.server.domain.download.DownloaderJob" />
		<property name="jobListenerNames">
			<list>
				<value>downloaderListener</value>
			</list>
		</property>
		<property name="jobDataAsMap">
			<map>
				<entry key="host" value="polar.ncep.noaa.gov" />
				<entry key="downloadFilePath"
					value="/pub/waves/develop/multi_1.latest_run/multi_1.glo_30m.all.grb2" />
<!--					<entry key="downloadFilePath"-->
<!--					value="/pub/waves/latest_run/akw.46001.bull" />-->
					
				<entry key="userName" value="anonymous" />
				<entry key="password" value="a@.com" />
				<entry key="destinationFilePath"
					value="c:/latestForecast.grb2" />
			</map>
		</property>
	</bean>


	<!--    THE TRIGGER WHICH WILL FIRE THE JOB-->
<!--	<bean id="simpleTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerBean">-->
<!--		<property name="jobDetail" ref="downloadNOAAForecastsJob" />-->
<!--		<property name="startDelay" value="5000" />-->
<!--		<property name="repeatInterval" value="21600000" />-->
<!--	</bean>-->
	<bean id="simpleTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
    <property name="jobDetail" ref="downloadNOAAForecastsJob" />
    <property name="cronExpression" value="0 0 0,6,12,18 * * ?" />
</bean>
	<!--    THE LISTENER OF THE JOB EXECUTION-->
	<bean id="downloaderListener"
		class="edu.unicen.surfforecaster.server.domain.download.DownloaderJobListener">
		<property name="name" value="downloaderListener" />
		<property name="observers">
			<list>
				<ref bean="waveWatchDaoTarget" />
			</list>
		</property>
		
	</bean>

	<!--COMMENTED AS WE ARE TESTING WE DO NOT WANT TO LOAD SCHEDULER-->
	<!--    REGISTER TRIGGERS AND LISTENERS WITH THE SCHEDULER -->
	<bean class="org.springframework.scheduling.quartz.SchedulerFactoryBean">

		<property name="triggers">
			<list>
				<ref bean="simpleTrigger" />
			</list>
		</property>
		<property name="jobListeners">
			<list>
				<ref bean="downloaderListener" />
			</list>
		</property>
	</bean>

	<!--    END QUARTZ CONFIGURATION -->
</beans>